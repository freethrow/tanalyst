{% extends "base.html" %}

{% block title %}{{ article.title_it|default:article.title_en }} · TA{% endblock %}

{% block content %}
  <article class="container mx-auto max-w-6xl">
    <header class="mb-6">
      <h1 class="text-3xl font-bold leading-tight mb-3">{{ article.title_it|default:article.title_en }}</h1>

      <div class="flex flex-wrap items-center gap-2 text-sm text-base-content/70">
        {% if article.article_date %}
          <div class="badge badge-outline" title="Original Article Date">
            {{ article.article_date|date:"Y-m-d" }}
          </div>
        {% endif %}
        {% if article.time_translated %}
          <div class="badge badge-outline" title="Date Translated">
            {{ article.time_translated|date:"Y-m-d H:i" }}
          </div>
        {% endif %}
        {% if article.llm_model %}
          <div class="badge badge-neutral" title="LLM Model">{{ article.llm_model }}</div>
        {% endif %}
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <section class="prose max-w-none lg:col-span-8">
        {{ article.content_it|default:article.content_en|linebreaksbr }}
      </section>

      <aside class="lg:col-span-4">
        <!-- DEBUG: related_articles = {{ related_articles|length }} -->
        {% if related_articles %}
          <div class="sticky top-4">
            <h2 class="text-lg font-semibold mb-3">Related Articles ({{ related_articles|length }})</h2>
            <ul class="menu bg-base-100 rounded-box">
              {% for ra in related_articles %}
                <li>
                  <a href="{% url 'articles:article_detail' ra.id %}">{{ ra.title_it }}</a>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% else %}
          <div class="text-sm text-base-content/70">No related articles found</div>
        {% endif %}
      </aside>
    </div>

    <footer class="mt-8 flex items-center justify-between">
      <a href="/" class="btn btn-ghost">← Back</a>

      <div class="flex gap-2">
        <a href="{% url 'articles:article_edit' article.pk %}" class="btn btn-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Edit Article
        </a>
        {% if article.url %}
          <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
            View Original Article
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 ml-2">
              <path d="M5.25 3A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V12a.75.75 0 00-1.5 0v6.75a.75.75 0 01-.75.75H5.25a.75.75 0 01-.75-.75V5.25a.75.75 0 01.75-.75H12a.75.75 0 000-1.5H5.25z" />
              <path d="M16.5 2.25a.75.75 0 000 1.5h3.19l-8.72 8.72a.75.75 0 101.06 1.06l8.72-8.72v3.19a.75.75 0 001.5 0V2.25H16.5z" />
            </svg>
          </a>
        {% endif %}
      </div>
    </footer>
  </article>
{% endblock %}